@* File: Views/Claim/MyClaims.cshtml *@
@model List<InsurancePolicyManagementSystems.Service.DTO.ClaimDTO>

@{
    ViewData["Title"] = "My Filed Claims";
}

<h2 class="text-center text-info mb-4">
    <i class="bi bi-list-task me-2"></i> My Filed Claims History
</h2>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success">@TempData["SuccessMessage"]</div>
}

@if (Model == null || !Model.Any())
{
    <div class="alert alert-info text-center" role="alert">
        You have not filed any claims yet.
    </div>
}
else
{
    <div class="table-responsive">
        <table class="table table-bordered table-striped table-hover">
            <thead class="table-dark">
                <tr>
                    <th>Claim ID</th>
                    <th>Policy Reg. ID</th>
                    <th>Incident Title</th>
                    <th>Amount</th>
                    <th>Date Filed</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var claim in Model.OrderByDescending(c => c.DateFiled))
                {
                    <tr>
                        @* <td>#@(claim.PolicyRegistrationId.ToString() + claim.DateFiled.Day.ToString() + claim.DateFiled.Minute.ToString())</td> *@
                        @* Placeholder Claim ID generation *@

                        <td>#@claim.Id</td>
                        <td>@claim.PolicyRegistrationId</td>
                        <td>@claim.IncidentTitle</td>
                        <td>INR @claim.RequestedAmount.ToString("N2")</td>
                        <td>@claim.DateFiled.ToShortDateString()</td>
                        @* File: Views/Claim/MyClaims.cshtml - Updated Status Column *@

                        <td>
                            @{
                                string status = claim.Status.ToLower();
                                string badgeClass = status switch
                                {
                                    "approved" => "bg-success",
                                    "rejected" => "bg-danger",
                                    _ => "bg-warning text-dark"
                                };
                            }
                            <span class="badge @badgeClass">@claim.Status</span>

                            @if (status == "approved")
                            {
                                <p class="text-success mt-1 mb-0 fw-bold">Approved Amount:</p>
                                <p class="text-success">INR @claim.ApprovedAmount.ToString("N2")</p>
                                @if (!string.IsNullOrEmpty(claim.AdminComments))
                                {
                                    <p class="text-muted small">Admin Note: @claim.AdminComments</p>
                                }
                            }
                            else if (status == "rejected")
                            {
                                <p class="text-danger mt-1 mb-0 fw-bold">Reason:</p>
                                <p class="text-danger">@claim.AdminComments</p>
                            }
                            @* No extra content needed for Pending/Submitted *@
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}

<a asp-controller="Policies" asp-action="AppliedPolicies" class="btn btn-primary mt-3">
    <i class="bi bi-shield-fill-check"></i> Back to Policies
</a>